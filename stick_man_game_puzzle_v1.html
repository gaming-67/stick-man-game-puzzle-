<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Stick Puzzle</title>
<style>
  html,body {
    margin:0; height:100%; overflow:hidden;
    background:#0f1724; color:#fff; font-family:sans-serif;
  }
  canvas {
    display:block;
    background:#0f1724;
  }
  /* MENU */
  #menu {
    position: fixed;
    inset: 0;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.7);
    flex-direction: column;
  }
  h1 {
    font-size: 36px;
    margin-bottom: 20px;
  }
  button {
    margin: 8px;
    padding: 12px 25px;
    font-size: 18px;
    border: none;
    border-radius: 6px;
    background: #3b82f6;
    color: white;
    cursor: pointer;
  }
  button:hover {
    background: #2563eb;
  }
  #levelText {
    position: fixed;
    top: 10px;
    left: 10px;
    font-size: 20px;
  }
</style>
</head>
<body>
<div id="menu">
  <h1>Stick Puzzle</h1>
  <button id="btn1p">1 Player</button>
  <button id="btn2p">2 Players</button>
</div>
<div id="levelText"></div>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth;
canvas.height = innerHeight;

let running = false;
let players = [];
let platforms = [];
let boxes = [];
let goals = [];
let level = 1;

const keys = {};
onkeydown = e => keys[e.code] = true;
onkeyup = e => keys[e.code] = false;

function makePlayer(x, y, color, controls) {
  return {x, y, w:20, h:50, vx:0, vy:0, color, controls, onGround:false};
}

function startGame(mode) {
  document.getElementById('menu').style.display = 'none';
  running = true;
  level = 1;
  loadLevel(mode);
  loop();
}

function loadLevel(mode) {
  const ground = canvas.height - 60;
  platforms = [
    {x:0,y:ground,w:canvas.width,h:60},
    {x:200,y:ground-150,w:150,h:15},
    {x:500,y:ground-250,w:200,h:15},
    {x:850,y:ground-180,w:180,h:15}
  ];

  boxes = [
    {x:230,y:ground-200,w:40,h:40,vx:0,vy:0},
    {x:540,y:ground-290,w:40,h:40,vx:0,vy:0}
  ];

  goals = mode==='2p' 
    ? [{x:1000,y:ground-240,w:40,h:60,color:'#38bdf8'},{x:1200,y:ground-240,w:40,h:60,color:'white'}]
    : [{x:1000,y:ground-240,w:40,h:60,color:'white'}];

  players = [makePlayer(100,ground-200,'white',{left:'ArrowLeft',right:'ArrowRight',jump:'ArrowUp'})];
  if(mode==='2p') players.push(makePlayer(200,ground-200,'#38bdf8',{left:'KeyA',right:'KeyD',jump:'KeyW'}));
  document.getElementById('levelText').textContent = `Level ${level}`;
}

function updatePlayer(p){
  const spd = 4;
  if(keys[p.controls.left]) p.vx = -spd;
  else if(keys[p.controls.right]) p.vx = spd;
  else p.vx = 0;
  if(keys[p.controls.jump] && p.onGround){
    p.vy = -14;
    p.onGround = false;
  }
  p.vy += 0.7; 
  p.x += p.vx;
  p.y += p.vy;

  p.onGround = false;
  for(const plat of platforms){
    if(p.x + p.w > plat.x && p.x < plat.x + plat.w &&
       p.y + p.h > plat.y && p.y + p.h < plat.y + 20 && p.vy >= 0){
         p.y = plat.y - p.h;
         p.vy = 0;
         p.onGround = true;
    }
  }

  // box collision (pushable)
  for(const b of boxes){
    if(p.x + p.w > b.x && p.x < b.x + b.w &&
       p.y + p.h > b.y && p.y < b.y + b.h){
      if(p.vx > 0) b.x += 2;
      else if(p.vx < 0) b.x -= 2;
    }
  }

  // gravity for boxes
  for(const b of boxes){
    b.vy += 0.7;
    b.y += b.vy;
    for(const plat of platforms){
      if(b.x + b.w > plat.x && b.x < plat.x + plat.w &&
         b.y + b.h > plat.y && b.y + b.h < plat.y + 20 && b.vy >= 0){
        b.y = plat.y - b.h;
        b.vy = 0;
      }
    }
  }
}

function drawPlayer(p){
  const cx = p.x + p.w/2;
  ctx.strokeStyle = p.color;
  ctx.lineWidth = 3;
  ctx.beginPath(); ctx.arc(cx,p.y+10,8,0,Math.PI*2); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(cx,p.y+18); ctx.lineTo(cx,p.y+38); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(cx,p.y+25); ctx.lineTo(cx-10,p.y+35); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(cx,p.y+25); ctx.lineTo(cx+10,p.y+35); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(cx,p.y+38); ctx.lineTo(cx-8,p.y+50); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(cx,p.y+38); ctx.lineTo(cx+8,p.y+50); ctx.stroke();
}

function drawPlatforms(){
  ctx.fillStyle = '#1e293b';
  for(const p of platforms) ctx.fillRect(p.x,p.y,p.w,p.h);
}

function drawBoxes(){
  ctx.fillStyle = '#64748b';
  for(const b of boxes) ctx.fillRect(b.x,b.y,b.w,b.h);
}

function drawGoals(){
  for(const g of goals){
    ctx.fillStyle = g.color;
    ctx.fillRect(g.x,g.y,g.w,g.h);
  }
}

function checkWin(){
  let allReached = true;
  for(let i=0;i<players.length;i++){
    const p = players[i];
    const g = goals[i];
    if(!(p.x+p.w>g.x && p.x<g.x+g.w && p.y+p.h>g.y && p.y<g.y+g.h)){
      allReached = false;
    }
  }
  if(allReached){
    ctx.fillStyle = 'rgba(0,0,0,0.7)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = 'white';
    ctx.font = '40px sans-serif';
    ctx.fillText('You Win!', canvas.width/2-80, canvas.height/2);
    running = false;
  }
}

function loop(){
  if(!running) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawPlatforms();
  drawBoxes();
  drawGoals();
  for(const p of players){
    updatePlayer(p);
    drawPlayer(p);
  }
  checkWin();
  requestAnimationFrame(loop);
}

document.getElementById('btn1p').onclick = () => startGame('1p');
document.getElementById('btn2p').onclick = () => startGame('2p');
</script>
</body>
</html>
